set(STARTUP_SOURCE ${CMAKE_CURRENT_SOURCE_DIR}/startup.asm)
set(STARTUP_BINARY ${CMAKE_BINARY_DIR}/startup.bin)
set(STARTUP_BINARY ${STARTUP_BINARY} PARENT_SCOPE)
string(TIMESTAMP G_BUILD_TIMESTAMP "'%Y-%m-%d',32,'%H:%M'")
set(STARTUP_DEFINE -d G_BUILD_TIMESTAMP="${G_BUILD_TIMESTAMP}")


find_program(FASM fasm)

add_custom_command(OUTPUT ${STARTUP_BINARY}
  BYPRODUCTS ${STARTUP_BINARY}
  COMMAND ${FASM} ${STARTUP_DEFINE} ${STARTUP_SOURCE} ${STARTUP_BINARY} 
  DEPENDS ${STARTUP_SOURCE}
  MAIN_DEPENDENCY  ${STARTUP_SOURCE}
  WORKING_DIRECTORY ${CMAKE4_BINARY_DIR}
  COMMENT "Compiling startup.bin"
)  

add_custom_target(startup_bin ALL DEPENDS ${STARTUP_BINARY} SOURCES ${STARTUP_SOURCE})

